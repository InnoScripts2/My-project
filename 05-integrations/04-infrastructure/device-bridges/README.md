# Device Bridges — Мосты к устройствам

## Назначение

Реализации драйверов и адаптеров для взаимодействия с физическими устройствами терминала: OBD-II адаптеры, толщиномеры, замки выдачи оборудования.

## Цель

Обеспечить унифицированный доступ к устройствам через единые интерфейсы с поддержкой:
- Различных протоколов связи (BLE, Serial, USB, GPIO)
- Автоматического переподключения при сбоях
- Таймаутов и обработки ошибок
- Dev-заглушек для разработки без реального оборудования

## Входы

- **OBD-II команды:**
  - `command: string` — AT-команда для ELM327 (например, "0100", "03", "04")
  - `port: string` — путь к COM-порту (Windows) или /dev/tty* (Linux)
  - `baudRate?: number` — скорость передачи (по умолчанию 38400)
  - `timeout?: number` — таймаут ответа в миллисекундах

- **Толщиномер команды:**
  - `action: 'connect' | 'measure' | 'disconnect'` — действие
  - `deviceId?: string` — BLE MAC-адрес или UUID устройства
  - `zone?: string` — зона измерения (для структурирования данных)

- **Замок команды:**
  - `slotId: string` — идентификатор слота (slot-thickness, slot-obd)
  - `action: 'open' | 'close' | 'status'` — действие с замком
  - `duration?: number` — длительность открытия в миллисекундах

## Выходы

- **OBD Response:**
  - `success: boolean` — успешность выполнения команды
  - `data: string | Array<string>` — ответ от адаптера (hex строки)
  - `dtcCodes?: Array<{ code: string; description: string }>` — коды неисправностей
  - `parameters?: Record<string, number>` — считанные параметры (RPM, temperature и т. д.)
  - `error?: string` — описание ошибки

- **Thickness Measurement:**
  - `value: number` — толщина покрытия в микронах
  - `zone: string` — зона измерения
  - `timestamp: Date` — время измерения
  - `quality?: 'good' | 'warning' | 'error'` — оценка качества сигнала

- **Lock Status:**
  - `slotId: string` — ID слота
  - `isOpen: boolean` — открыт ли замок
  - `lastAction?: Date` — время последнего действия
  - `error?: string` — описание ошибки (если есть)

## Принципы

- **Изоляция:** Драйверы изолированы от бизнес-логики приложения
- **Устойчивость:** Автоматическое переподключение при потере связи
- **Безопасность:** Таймауты для всех операций, логирование аномалий
- **Тестируемость:** Dev-заглушки для разработки без оборудования

## Интеграция

Используется в:
- `03-apps/kiosk-agent/src/devices/` — интеграция в агент
- `01-interfaces/` — контракты устройств
- `05-tests/` — моки устройств для тестирования
