# Storage — Доменные модели хранилища

## Назначение

Доменные модели и политики для работы с различными типами хранилищ данных: локальное (SQLite, файлы), облачное (Supabase Storage), кэш (Redis).

## Цель

Определить единые модели данных и бизнес-правила для хранения:
- Сессий киоска
- Отчётов (HTML/PDF)
- Логов самопроверок устройств
- Метаданных платежей
- Настроек и конфигурации

## Входы

- **Запись данных:**
  - `key: string` — уникальный ключ записи
  - `value: any` — сохраняемые данные (объект, примитив, буфер)
  - `ttl?: number` — время жизни в секундах (для кэша)
  - `metadata?: Record<string, any>` — дополнительные метаданные

- **Чтение данных:**
  - `key: string` — ключ записи
  - `options?: { includeMetadata?: boolean }` — опции чтения

- **Файл:**
  - `path: string` — путь к файлу (локальный или облачный)
  - `content: Buffer | string` — содержимое файла
  - `contentType?: string` — MIME-тип файла

- **Запрос списка:**
  - `prefix?: string` — префикс ключей для фильтрации
  - `limit?: number` — максимальное количество записей
  - `cursor?: string` — курсор для пагинации

## Выходы

- **StorageRecord:**
  - `key: string` — ключ записи
  - `value: any` — хранимые данные
  - `createdAt: Date` — время создания
  - `updatedAt?: Date` — время обновления
  - `expiresAt?: Date` — время истечения (для TTL)
  - `metadata?: Record<string, any>` — метаданные

- **FileRecord:**
  - `path: string` — путь к файлу
  - `url?: string` — публичный/signed URL для доступа
  - `size: number` — размер файла в байтах
  - `contentType: string` — MIME-тип
  - `uploadedAt: Date` — время загрузки

- **ListResult:**
  - `records: Array<StorageRecord>` — найденные записи
  - `hasMore: boolean` — есть ли ещё записи
  - `nextCursor?: string` — курсор для следующей страницы

## Принципы

- **Абстракция:** Единые модели для локального и облачного хранилищ
- **TTL:** Автоматическая очистка устаревших данных
- **Приватность:** Минимальное хранение персональных данных
- **Резервирование:** Возможность дублирования критичных данных

## Интеграция

Используется в:
- `04-infrastructure/` — реализации для SQLite, Supabase, файловой системы
- `03-apps/kiosk-agent/` — хранение сессий, отчётов, логов
- `02-application/` — оркестрация бизнес-логики хранения
