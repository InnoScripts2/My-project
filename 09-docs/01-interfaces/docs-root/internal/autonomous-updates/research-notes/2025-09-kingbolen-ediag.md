# KINGBOLEN Ediag — исследовательская заметка

- **Дата:** 2025-09-30
- **Инициатор:** GitHub Copilot
- **Контекст:** Рассматриваем адаптер KINGBOLEN Ediag (линейка Ediag / Ediag Plus / Ediag Elite) как замену текущему OBD-II оборудованию киоска самообслуживания.

## Резюме
- Поддерживается Bluetooth 5.0/5.1 (Classic + LE), CAN/UDS и расширенные протоколы (CAN-FD, DoIP, FCA AutoAuth).
- Адаптер совместим с семейством команд ELM327, что позволяет использовать существующие драйверы без форка.
- Питание от шины OBD-II (9–18 В), потребление ≤130 мА, аппаратного sleep-режима нет — требуется keep-alive со стороны киоска.
- Официальный SDK отсутствует; интеграция осуществляется через AT-команды и UDS поверх ISO-TP.
- Сторонние приложения ограничены, однако прямых запретов на собственный софт нет (фирменное приложение Ediag остаётся необязательным).
- Целевое окружение киоска — Android 8.0+ (API 26); любые действия клиента остаются минимальными, поэтому подключение адаптера и диагностические потоки должны запускаться автоматически.

## Аппаратные характеристики
| Параметр | Значение |
| --- | --- |
| Интерфейс подключения | 16-pin OBD-II, Bluetooth 5.0/5.1 dual mode |
| Диагностический интерфейс | CAN (ISO 15765-4), ISO 14230-4, ISO 9141-2, SAE J1850 VPW/PWM |
| Расширенные протоколы | ISO 14229 (UDS), CAN-FD, DoIP, FCA AutoAuth |
| Доп. разъём | DB15 (для расширенной периферии в некоторых комплектациях) |
| Питание | 9–18 В от разъёма OBD-II |
| Потребление | ≤130 мА |
| Рабочая температура | −10…+50 °C |
| Размеры | 120.5 × 65 × 29 мм |

## Протоколы и командный набор
- Совместим с ELM327: `ATZ`, `ATI`, `ATSP`, `ATSH`, `ATCRA`, `ATAL`, `ATH1`, `ATS0`, `ATSL0` и другие.
- Поддерживает UDS через ISO-TP; CAN-FD и DoIP заявлены для новых моделей с Ethernet.
- Предполагается задержка ~500 мс при блютуз-соединении, однопоточный режим (последовательные запросы).

## Энергосбережение и надёжность
- Автоперехода в sleep нет → важно настроить keep-alive (например, `0100` каждые 30–60 секунд) и мониторинг соединения.
- Требуется обработка переподключений Bluetooth и таймаутов команд (5–10 с на команду, до 30 с на сессию).

## Интеграционные выводы
1. **Транспорт:** основной канал — Bluetooth Classic на Android (API 26+). Для Windows-киоска потребуется BLE ↔ COM мост или адаптация node/libary.
2. **Драйвер:** существующий модуль `apps/kiosk-agent/src/devices/obd` можно расширить, оставив абстракцию «ELM327-совместимый транспорт».
3. **UDS:** для CAN-FD/DoIP возможно подключение `packages/uds-c` (планируется), но сначала фиксируем ELM327-режим.
4. **Watchdog:** добавить keep-alive и метрики сигнализации (в self-check отчёты).
5. **Лицензии:** аппарат не накладывает ограничений на клиентское ПО; следим за условиями FCA AutoAuth (может требовать аккаунта).
6. **Автоматизация:** все сервисные процедуры (поиск устройства, сопряжение, восстановление связи) выполняются агентом без участия клиента; конфигурация и ручные операции перемещаются в будущую админ-панель.

## Риски и открытые вопросы
- Нужны реальные тесты на Toyota/Lexus (CAN 11/29 бит) для подтверждения UDS и ISO-TP.
- Не подтверждена доступность CAN-FD и DoIP без фирменного приложения.
- Требуется уточнить процесс регистрации (активации) для работы без фирменного ПО.
- Необходимо измерить стабильность задержек и качественно протестировать переподключения.

## Предлагаемые следующие шаги
1. Подготовить интеграционный план (см. `docs/internal/autonomous-updates/drafts/2025-09-kingbolen-ediag-integration-plan.md`).
2. Настроить тестовый стенд с Android 8 киоском и адаптером Ediag Elite, проверить автоподключение после перезапуска.
3. Провести серию smoke-тестов ELM327-команд и логирование задержек, убедившись в полной автоматизации диагностических сценариев.
4. Определить требования к keep-alive и обновить self-check скрипты.
5. Обновить документацию и инструкции по обслуживанию после пилота.

## Источники
- Бриф владельца проекта (2025-09-30), внутренние заметки и спецификации KINGBOLEN.
