# Документ миграции структуры проекта

## Обзор

Данный документ описывает перенос файловой структуры проекта с плоской организации на иерархическую архитектуру на основе принципов DDD (Domain-Driven Design) и Чистой архитектуры.

**Дата миграции:** 2024–2025  
**Версия:** Цикл-3 (физическое перемещение) + Цикл-4 (обновление ссылок)  
**Статус:** ✅ Завершена и проверена  
**Финальный отчёт:** См. `prompts/cycle-4/prompt-10-final-connector-and-status.md`

## Новая структура

Проект теперь организован в 10 корневых блоков:

1. **01-core** — Ядро системы
2. **02-domains** — Доменные модули
3. **03-apps** — Приложения
4. **04-packages** — Переиспользуемые пакеты
5. **05-integrations** — Интеграции с внешними системами
6. **06-infra** — Инфраструктура
7. **07-ops** — Операции и мониторинг
8. **08-security** — Безопасность
9. **09-docs** — Документация
10. **10-tools** — Инструменты разработки

Каждый корневой блок содержит 5 стандартных подпапок:

- `01-interfaces/` — Интерфейсы и контракты
- `02-application/` — Прикладная логика
- `03-domain/` — Доменные модели
- `04-infrastructure/` — Инфраструктурные реализации
- `05-tests/` — Тесты

## Таблица соответствий путей

### Приложения

| Старый путь | Новый путь | Описание |
|-------------|------------|----------|
| `apps/kiosk-agent/` | `03-apps/02-application/kiosk-agent/` | Локальный агент киоска (Node.js/TypeScript) |
| `apps/kiosk-frontend/` | `03-apps/02-application/kiosk-frontend/` | Фронтенд интерфейс киоска (HTML/CSS/JS) |
| `apps/android-kiosk/` | `03-apps/02-application/android-kiosk/` | Android-версия киоска |
| `apps/cloud-api/` | `03-apps/02-application/cloud-api/` | Облачный API сервис |

### Доменные модули (бывшие packages)

| Старый путь | Новый путь | Описание |
|-------------|------------|----------|
| `packages/device-obd/` | `02-domains/03-domain/device-obd/` | Модуль работы с OBD-II устройствами |
| `packages/device-thickness/` | `02-domains/03-domain/device-thickness/` | Модуль работы с толщиномером |
| `packages/payments/` | `02-domains/03-domain/payments/` | Модуль платёжной интеграции |
| `packages/report/` | `02-domains/03-domain/report/` | Модуль генерации отчётов |

### Инфраструктура

| Старый путь | Новый путь | Описание |
|-------------|------------|----------|
| `infra/` | `06-infra/04-infrastructure/infra-root/` | Инфраструктурные скрипты и конфигурации |
| `infra/scripts/` | `06-infra/04-infrastructure/infra-root/scripts/` | Утилиты разработки и развертывания |
| `infra/sql-server/` | `06-infra/04-infrastructure/infra-root/sql-server/` | Конфигурации SQL Server |

### Документация

| Старый путь | Новый путь | Описание |
|-------------|------------|----------|
| `docs/` | `09-docs/01-interfaces/docs-root/` | Вся документация проекта |
| `docs/product/` | `09-docs/01-interfaces/docs-root/product/` | Продуктовая документация |
| `docs/tech/` | `09-docs/01-interfaces/docs-root/tech/` | Техническая документация |
| `docs/legal/` | `09-docs/01-interfaces/docs-root/legal/` | Юридические документы |
| `docs/internal/` | `09-docs/01-interfaces/docs-root/internal/` | Внутренняя документация |

### Инструменты и артефакты

| Старый путь | Новый путь | Описание |
|-------------|------------|----------|
| `apps/artifacts/` | `10-tools/04-infrastructure/artifacts/` | Артефакты сборки и логи |
| `вспомогательные ресурсы/*` и `партнёрские программы/*` | `10-tools/01-interfaces/third-party/*` | Сторонние материалы и справочные артефакты |

## Принципы новой структуры

### Разделение ответственности

Каждый блок имеет чётко определённую ответственность:

- **Core** — центральные компоненты без внешних зависимостей
- **Domains** — изолированная бизнес-логика
- **Apps** — точки входа и оркестрация
- **Packages** — переиспользуемые библиотеки
- **Integrations** — адаптеры внешних систем
- **Infra** — технические детали развертывания
- **Ops** — мониторинг и поддержка
- **Security** — аспекты безопасности
- **Docs** — документация всех уровней
- **Tools** — утилиты разработки

### Слоистая архитектура

Внутри каждого блока:

1. **Interfaces** — контракты (без реализации)
2. **Application** — оркестрация и use cases
3. **Domain** — бизнес-логика
4. **Infrastructure** — технические детали
5. **Tests** — проверки

### Зависимости

Рекомендуемые направления зависимостей:

```text
Apps → Domains → Core
     ↓         ↓
Integrations  Packages
     ↓
Infrastructure
```

## Важные замечания

### Что НЕ изменено

В соответствии с требованиями этого цикла миграции:

- ✅ **Содержимое файлов** — не изменено
- ✅ **Импорты и пути** — не обновлены (требуется в следующем цикле)
- ✅ **Конфигурации** — не обновлены (package.json, tsconfig.json и т.д.)
- ✅ **Сборка** — может быть нарушена до обновления путей

### Следующие шаги

После завершения файлового переноса необходимо:

1. **Обновить пути импортов** во всех TypeScript/JavaScript файлах
2. **Обновить конфигурации**:
   - `package.json` (scripts, paths)
   - `tsconfig.json` (paths, baseUrl)
   - `.eslintrc.cjs` (пути к файлам)
   - `vite.config.ts` / `webpack.config.js`
3. **Обновить ссылки в документации**
4. **Обновить CI/CD пайплайны** (пути в GitHub Actions)
5. **Протестировать сборку** всех компонентов
6. **Обновить .gitignore** при необходимости

## Проверка миграции

### Контрольный список

- [x] Создано 10 корневых блоков
- [x] В каждом блоке 5 стандартных подпапок
- [x] Перенесены все приложения (kiosk-agent, kiosk-frontend, android-kiosk, cloud-api)
- [x] Перенесены все доменные модули (device-obd, device-thickness, payments, report)
- [x] Перенесена инфраструктура (infra → 06-infra)
- [x] Перенесена документация (docs → 09-docs)
- [x] Перенесены артефакты (apps/artifacts → 10-tools)
- [x] Созданы README.md во всех корневых блоках
- [x] Создан документ миграции

### Команды проверки

```bash
# Проверить структуру корневых блоков
ls -d 0*-*/

# Проверить подпапки в каждом блоке
for dir in 0*-*/; do echo "=== $dir ==="; ls "$dir"; done

# Проверить перенесённые приложения
ls 03-apps/02-application/

# Проверить перенесённые домены
ls 02-domains/03-domain/

# Проверить перенесённую инфраструктуру
ls 06-infra/04-infrastructure/

# Проверить перенесённую документацию
ls 09-docs/01-interfaces/

# Проверить наличие README во всех блоках
ls 0*-*/README.md
```

## История изменений

| Дата | Версия | Описание |
|------|--------|----------|
| 2024 | v1.0 | Первоначальная миграция на DDD + Clean Architecture |

## Контакты и поддержка

При возникновении вопросов о новой структуре обращайтесь к:

- Документации проекта: `09-docs/01-interfaces/docs-root/`
- Инструкциям проекта: `.github/instructions/`

---

**Статус миграции:** ✅ Полностью завершена (Cycle-3: файлы, Cycle-4: пути и конфигурации)  
**Дата завершения:** 2024-10-04  
**Документ завершения:** `09-docs/01-interfaces/CYCLE4_MIGRATION_COMPLETION.md`

