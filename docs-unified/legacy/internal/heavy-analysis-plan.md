# План полномасштабного анализа и подготовки промптов

ЦЕЛЬ
Сформировать полномасштабный, строгий и детализированный план анализа и дальнейшей разработки с использованием ресурсов из папок вспомогательные ресурсы и доп ресурсы, а также ранее проанализированных проектов. Подготовить 15 тяжеловесных промптов: 5 промптов для доработки уже анализировавшихся проектов, 10 промптов для реализации идей и интеграций из доп ресурсы. Промпты непересекающиеся, 400–500 строк плотного технического текста каждый. Анализ разделить на 10 частей. Завершить за 20 сессий: очистка и подготовка, затем реализация после команды начать.

ОГРАНИЧЕНИЯ И ПРАВИЛА
Без специальных символов и декоративных элементов. Минимум пустых строк. Стиль: плотный технический текст с привязкой к именам файлов, функций, интерфейсов и конфигураций. Соблюдать .github/instructions/instructions.instructions.md и .github/copilot-instructions.md. Не нарушать лицензии третьих сторон; использовать допустимые конфигурации, схемы, дашборды и шаблоны, не встраивать чужой закрытый код.

ОБЩАЯ СХЕМА РАБОТЫ
Подготовительный этап: очистка устаревших промптов и материалов, фиксация плана. Аналитический этап: 10 частей анализа по архитектуре, устройствам, фронтенду, агенту, платежам, отчетам, мониторингу, безопасности, эксплуатации и интеграциям. Этап генерации промптов: формирование 15 промптов в согласованных циклах без пересечений. Этап контроля качества: сборка, линтеры, тесты, проверка деплоя на Pages и APK сборки. Этап запуска: выполнение после подтверждения.

ПРЕДВАРИТЕЛЬНАЯ ОЧИСТКА
Устаревшие промпты в docs/prompts помечены как DEPRECATED для исключения пересечений. Внутренние заметки сохранены для источников фактов. По необходимости перенос в архив оформляется перед началом реализации.

СТРУКТУРА АНАЛИЗА ПО 10 ЧАСТЯМ

1. Архитектура и границы слоев
Цель: привести монорепозиторий к четким границам UI, Application, Domain, Device Drivers, Infra. Вход: apps/android-kiosk, apps/kiosk-agent, apps/kiosk-frontend, packages, infra, docs. Действия: инвентаризация export surface пакетов, выявление циклических зависимостей, фиксация публичных контрактов (TS интерфейсы, HTTP API схемы, события). Выход: диаграмма связей, перечень модулей усиления, матрица правил импортов, список технического долга. Риски: разрыв совместимости; Митигция: семантические версии и адаптеры.

2. OBD-II драйверы и протокол
Цель: детализировать протокол ELM327, список команд, форматы PID/DTC/FreezeFrame, таймауты и восстановление. Вход: apps/kiosk-agent/src/devices/obd/*, вспомогательные ресурсы с библиотеками node-obd2-master, node-bluetooth-obd-master, ecu-simulator-master, esp32-obd2-master, uds-c-master. Действия: таблица команд init/select protocol/read dtc/clear dtc/read pid, карта ошибок (no adapter, timeout, framing), очередь запросов, backoff. Выход: спецификация интерфейсов DeviceObd, схемы Zod, список юнит-тестов с фикстурами. Риски: несовместимость адаптеров; Митигция: capability detection и graceful degrade.

3. Толщиномер BLE стек
Цель: определить BLE GATT профили, поток измерений 40–60 полей, обработку статусов и таймаутов. Вход: толщиномер ЛКП ресурсы, BLE_THSensor-master, ble_monitor-master. Действия: карта сервисов/характеристик, контракт DeviceThickness, буфер и нормализация данных, обработка разрыва соединения. Выход: спецификация драйвера, тест-план, сценарии UX отображения прогресса. Риски: закрытый протокол; Митигция: работа только по официальным спецификациям или SDK.

4. Фронтенд поток киоска
Цель: стабилизировать экранные сценарии, статусы устройств, paywall и доступность. Вход: index.html, styles.css, service-worker.js, manifest.webmanifest. Действия: декомпозиция скриптов на модули, политика кеша SW и инвалидации при Pages деплое, тесты навигации. Выход: план модульной структуры, список UI тестов, бюджет производительности. Риски: разнородные состояния; Митигция: единый store состояния экрана.

5. Платежи и Paywall
Цель: уточнить контракты платежей DEV/PROD, статусы и повторные попытки. Вход: apps/kiosk-agent/src/payments/*, docs/tech. Действия: API createIntent/getStatus/confirm, обработка сбоев сети, таймаут платежа и отмена. Выход: диаграмма последовательностей, матрица статусов, тестовые стенды. Риски: несогласованность UI/бэкенд; Митигция: договор API и контрактные тесты.

6. Отчеты и доставка
Цель: стандартизировать PDF/HTML отчеты, предпросмотр и отправку. Вход: packages/report, docs/tech. Действия: шаблоны HTML, стили, генерация PDF, email/SMS адаптер, локальное хранилище и очистка. Выход: перечень шаблонов, формат итоговых данных, тесты генерации. Риски: избыточные персональные данные; Митигция: минимум данных и сроки хранения.

7. Мониторинг и алерты
Цель: внедрить метрики агента, UI health и дашборды. Вход: apps/kiosk-agent/src/monitoring/*, доп ресурсы grafana-dashboards-3, prometheus-master, sentry-master. Действия: экспорт /metrics, список метрик, конфиг алертов, панели Grafana с экспортом JSON. Выход: каталог dashboards/, перечень алертов, руководство оператора. Риски: шум алертов; Митигция: пороги и подавления.

8. Безопасность и удаленный доступ
Цель: зафиксировать hardening и безопасный удаленный доступ. Вход: доп ресурсы wazuh-main, firezone-main, guacamole-server-main, MeshCentral-master. Действия: чек-лист харденига ОС киоска, агенты мониторинга, ZTNA доступ, роли оператора read-only. Выход: docs/internal/security-hardening.md, конфиги агентов. Риски: расширение поверхности атаки; Митигция: минимальный набор агентских функций, журналирование.

9. CI/CD и эксплуатация
Цель: устойчивый пайплайн Pages и сборки APK, линтеры и тесты. Вход: .github/workflows/deploy.yml, infra/scripts/apk-build.ps1. Действия: матрица Node, кэш npm, проверки lint и tests, ретраи, уведомления. Выход: обновленный workflow, чек-листы запуска, FAQ по сбоям. Риски: задержки деплоя Pages; Митигция: кэш и артефакты.

10. Интеграции по доп ресурсы и вспомогательные ресурсы
Цель: создать карту применимости каталогов и приоритезацию внедрений. Вход: структура папок админ панель ресурсы, библиотеки ресурсы, защита ресурсы, ИИ ресурсы, передача файлов ресурсы, сервисы и APK для сервера и аналитики, толщиномер ЛКП ресурсы, удалённый доступ ресурсы, proxy ресурсы, SQL ресурсы; а также вспомогательные ресурсы с OBD и смежными проектами. Действия: таблица применимости, ограничения лицензий, риски эксплуатации на киоске. Выход: resources-inventory.md и внедренческий roadmap. Риски: перегрузка системы; Митигция: вынос тяжелых сервисов за пределы киоска.

ЦИКЛЫ БЕЗ ПЕРЕСЕЧЕНИЙ
Цикл 1: части 1–4. Цикл 2: части 5–6. Цикл 3: части 7–10. Цикл 4: подготовка промптов 1–5. Цикл 5: подготовка промптов 6–10. Цикл 6: подготовка промптов 11–15. Последовательность согласуется с требованием сначала 1,2,3,4 затем 5,6 затем 7,8,9,10 затем 11–15. Дублирования номеров в разных циклах нет.

ПРОМПТЫ 15 ШТУК, НЕПЕРЕСЕКАЮЩИЕСЯ ОБЛАСТИ

1. OBD-II драйвер низкого уровня
Фокус: команды ELM327, PID/DTC парсинг, таймауты, очередь запросов. Вход: вспомогательные ресурсы node-bluetooth-obd-master, node-obd2-master, uds-c-master. Выход: модуль drivers/, парсеры, юнит-тесты. Границы: без API и фронтенда.
2. OBD-II оркестрация и API агента
Фокус: REST/WebSocket поверх драйвера, стейт-машина подключение/сканирование, ошибки. Вход: п.1. Выход: routes и websocket модуль, контрактные тесты. Границы: без UI визуализаций.
3. Толщиномер BLE драйвер
Фокус: BLE GATT для измерений, события, буферизация. Вход: BLE_THSensor-master, ble_monitor-master. Выход: драйвер и тесты. Границы: без отчетов и платежей.
4. Фронтенд диагностический поток
Фокус: экраны подключения/сканирования/результатов, статусы устройств. Вход: п.2. Выход: модульные JS, UI тесты. Границы: без платежей и отчетов.
5. Paywall и платежи
Фокус: createIntent/getStatus/confirm, ретраи, DEV/PROD. Вход: интерфейс платежей. Выход: адаптеры и тесты. Границы: не затрагивает отчеты.
6. Отчеты и доставка
Фокус: HTML/PDF, предпросмотр, email/SMS. Вход: данные диагностик. Выход: шаблоны, генерация, тесты. Границы: платежи неизменны.
7. Мониторинг и алерты
Фокус: метрики агента, панели Grafana, Sentry. Вход: grafana-dashboards-3, prometheus-master. Выход: dashboards/, алерты. Границы: не меняет бизнес-логику.
8. Безопасность и удаленный доступ
Фокус: hardening, Wazuh, Firezone, Guacamole/MeshCentral паттерны. Вход: доп ресурсы. Выход: конфиги и инструкции. Границы: только операционная безопасность.
9. Передача файлов отчетов
Фокус: локально управляемое хранилище и синхронизация. Вход: seafile-master, kinto-main. Выход: адаптер выгрузки. Границы: структура отчетов не меняется.
10. Proxy и оптимизация медиа
Фокус: imgproxy для изображений отчетов. Вход: imgproxy-master. Выход: конфиги, интеграция через внешнюю службу. Границы: без изменений UI.
11. SQL и аналитика событий
Фокус: схема событий, экспорт на внешнюю аналитику. Вход: countly-server-master, druid-master, aptabase-main. Выход: спецификация событий и коннекторы. Границы: мониторинг не меняется.
12. Админ-консоль оператора
Фокус: read-only панели состояния киоска. Вход: dashboard-master, material-dashboard, gentelella. Выход: статическая консоль оператору. Границы: киоск UI неизменен.
13. Инвентаризация ОС и сеть
Фокус: osquery, librenms паттерны запросов. Вход: osquery-master, librenms-master. Выход: профили запросов и экспорты. Границы: безопасность не затрагивается.
14. ИИ оркестрации задач
Фокус: автоматизация рутины: очистка, выгрузка, архив. Вход: activepieces-main. Выход: сценарии automation. Границы: не меняет пайплайн CI/CD.
15. Эксплуатация и SLA
Фокус: openstatus, uptime-kuma статусы и SLO. Вход: openstatus-main, uptime-kuma-master. Выход: спецификация статусов и отчётности. Границы: алерты не меняются.

ДОПУСК И КРИТЕРИИ ГОТОВНОСТИ
На каждую часть анализа: входные артефакты, перечень действий, выходные спецификации, список рисков, тест-план, acceptance checklist. На каждый промпт: цели, входы/выходы, ограничения, создаваемые файлы, тесты, критерий Done. Сборка без ошибок, линтеры без предупреждений, тесты зелёные, Pages деплой выполняется, APK сборка успешна.

РИСКИ И МИТИГАЦИИ
Встраивание тяжелых проектов из доп ресурсы в киоск запрещено. Использовать конфиги, схемы, дашборды, паттерны. Хранить уведомления о лицензиях. Без симуляций данных в PROD. Изоляция DEV через флаги. Уменьшать поверхность атаки при добавлении агентов.

ГРАФИК НА 20 СЕССИЙ
1–2: очистка и финализация плана. 3–7: анализ частей 1–5. 8–10: анализ частей 6–10. 11–13: промпты 1–4. 14–15: промпты 5–6. 16–18: промпты 7–10. 19–20: промпты 11–15. Реализация начинается после команды начать.
