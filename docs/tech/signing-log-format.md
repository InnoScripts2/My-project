# Формат журнала подписей DTC-пакетов

## Назначение
`logs/signing.log` фиксирует каждое использование `tools/data-migration/sign_package.py`. Журнал необходим для аудита цепочки поставки и восстановления истории выпусков.

## Формат записи
Каждая строка файла — отдельный JSON-объект (JSONL). Поля отсортированы по ключу для упрощения сравнения в системах контроля версий.

| Поле | Тип | Описание |
|------|-----|----------|
| `archive` | string | Абсолютный путь к созданному `.obdresource`.
| `checksum` | string | SHA-256 архива после канонического упаковщика.
| `keyId` | string | Идентификатор ключа, указанного при подписи (`--key-id`).
| `manifest` | string | Абсолютный путь к `manifest.json`, который был обновлён в процессе подписи.
| `packageId` | string | Значение из `manifest.json`.
| `records` | number | Количество записей (`manifest.records`).
| `signature` | string | Абсолютный путь к файлу подписи `.sig`.
| `timestamp` | string | Метка времени в формате ISO 8601 (`YYYY-MM-DDTHH:MM:SSZ`).
| `version` | string | Значение `manifest.version`.

## Правила ведения
- Журнал ведётся на машине release-инженера, хранится в защищённом разделе с ограниченным доступом.
- По завершении сессии подписи запись выгружается в защищённое хранилище (например, зашифрованный репозиторий или сейф секретов).
- Минимальный срок хранения: 24 месяца.
- Разрешено архивировать файл после превышения объёма 10 МБ; архивы маркируются по кварталам (`signing-2025-Q4.log.gz`).

## Процедуры аудита
- Ежемесячно SecOps проверяет журнал на предмет незнакомых `packageId` или несогласованных ключей.
- Раз в квартал release-инженер сверяет записи с журналами публикаций CDN и отчётами операторов.
- При инциденте компрометации ключа журнал используется для обновления CRL и определения перечня пакетов для переподписи.

## Ротация ключей
При плановой ротации ключей необходимо отметить в журнале первую запись с новым `keyId` и приложить ссылку на акт ротации (см. `docs/internal/update-playbook.md`).
