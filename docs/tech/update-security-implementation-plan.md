# План внедрения требований безопасности обновлений DTC

Документ конкретизирует пункты из `docs/tech/update-security-requirements.md` и распределяет задачи между командами инфраструктуры и разработки.

## 1. Ключевая инфраструктура

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| Офлайн-хранение приватного ключа | Подготовить аппаратный сейф с шифрованием диска, настроить журнал доступа (two-person rule). | Lead инфраструктуры + Release инженер | 2025-10-20 | В ожидании утверждения |
| Публикация публичного ключа | Добавить `keys/public_ed25519.pem` в репозиторий конфигурации агента и pipeline фронтенда. | Команда DevOps | 2025-10-17 | В процессе |
| Ротация ключей ежегодно | Настроить напоминание в Azure DevOps/Calendar, подготовить процедуру `key rollover`. | Release инженер | 2025-11-01 | Планируется |

## 2. Репозиторий обновлений (S3/Blob + CDN)

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| HTTPS-доставка с MFA на запись | Настроить bucket `dtc-packages`, включить MFA delete и IAM с условием `aws:MultiFactorAuthPresent`. Альтернатива — Azure Blob с RBAC и Azure AD MFA. | DevOps | 2025-10-24 | Планируется |
| Логирование операций | Включить S3 Access Logs / Azure Storage Diagnostics, настроить экспорт в SIEM (`logs/update-distribution`). | SecOps | 2025-10-24 | Планируется |
| Retention 24 месяца | Политика lifecycle для автоматического архивирования в Glacier/Azure Archive. | Infra | 2025-10-31 | Планируется |

## 3. Кэш и офлайн-доставка на киоске

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| Локальный кэш `/data/updates/dtc` | Добавить tmpfs→disk fallback, провести тестирование на сбой питания. | Команда агент | 2025-10-28 | Планируется |
| Проверка двух файлов (архив + подпись) | Включена в `verify_package.py`. Дополнительно добавить проверку в агенте при USB-импорте. | Команда агент | 2025-10-18 | В процессе |
| Quarantine каталога | Создать директорию `/data/updates/quarantine`, настроить ротацию логов. | Команда агент | 2025-10-28 | Планируется |

## 4. Аудит и журналы

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| Журнал `update-agent.log` | Определить формат JSONL, подключить shipper в центральное хранилище. | Agent + SecOps | 2025-10-22 | Планируется |
| Журнал подписи `signing.log` | Добавить генерацию в `sign_package.py`, хранить в защищённом репозитории, задокументировать формат. | Release инженер | 2025-10-20 | Готово |
| Аудит `signing.log` | Подготовить чек-лист аудита, представить скрипт `check_signing_log.py`, встроить процедуру в ежемесячный план SecOps. | SecOps | 2025-10-22 | Готово |
| Ретенция 24 месяца | Выбрать хранилище (Azure Log Analytics / Loki), документировать процедуру удаления. | SecOps | 2025-10-31 | Планируется |

## 5. Ротация и отзыв ключей

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| Выпуск CRL | Реализовать JSON-файл `revoked-keys.json`, доставлять с агентом и на CDN. | DevOps + Agent | 2025-11-07 | Планируется |
| Процесс переупаковки | Подготовить чек-лист в `docs/internal/update-playbook.md` раздел "Инциденты". | Release инженер | 2025-10-25 | В процессе |

## 6. Инцидент-менеджмент

| Требование | Действие | Ответственный | Срок | Статус |
|------------|----------|---------------|------|--------|
| Остановка выпуска | Настроить runbook: триггеры в PagerDuty, шаблон уведомления операторам. | SecOps | 2025-10-25 | Планируется |
| Уведомление операторов | Создать email-шаблон и SMS-сценарий, завести в CRM. | Support | 2025-10-25 | Планируется |

## 7. Совместные действия с владельцем инфраструктуры

- Провести встречу до 2025-10-16 для согласования сроков и подтверждения ответственных.
- По итогам встречи обновить статусы задач и интегрировать с системой трекинга (Azure Boards).
- Назначить ответственное лицо за контроль ротации ключей и аудит логов.

## 8. Следующие шаги

1. Отправить документ владельцу инфраструктуры для ревью.
2. Получить подтверждение и зафиксировать задачи в трекере.
3. Обновить `docs/internal/update-playbook.md` после появления новых процедур.
