# Анализ часть 3 толщиномер BLE стек

КОНТЕКСТ
Цель: определить BLE GATT профили, поток измерений 40–60 полей, обработку статусов и таймаутов. Вход: толщиномер ЛКП ресурсы с BLE_THSensor-master, ble_monitor-master, TFT_eSPI-master.

BLE GATT ПРОФИЛЬ
Service UUID: фиксируется по документации устройства или reverse engineering (только с разрешения). Characteristics: measurement (read/notify), control (write), status (read). Descriptors: CCCD для включения notify. Адресация по MAC или device name.

МОДЕЛЬ ИЗМЕРЕНИЙ
Структура 40–60 точек: зоны кузова (капот, крыша, двери, крылья, пороги), значения в микронах, нормализация 80–150 мкм (заводское ЛКП), флаги отклонения. Поток данных: периодическое получение по notify или batch-read. Буферизация до завершения цикла.

СОБЫТИЯ И СТАТУСЫ
События: device-detected, connected, measurement-received, measurement-complete, disconnected, error. Статусы: idle, scanning, connected, measuring, complete. Timeout на обнаружение 15 сек, подключение 10 сек, измерение 5 мин (с учётом ручного процесса).

ОБРАБОТКА РАЗРЫВА
Разрыв соединения: сохранение частичных данных с пометкой incomplete, возможность повторного подключения и продолжения. Circuit breaker: при N последовательных сбоях переход в unavailable. Retry политика: 3 попытки с backoff.

UX И ПРОГРЕСС
UI отображает: количество измеренных точек, оставшиеся зоны, прогресс-бар, инструкции, какую зону сейчас измерять. Без симуляций в PROD. DEV: кнопка пропустить без генерации фейковых данных.

ИНТЕРФЕЙС DEVICETHICKNESS
init(config): сканирование и подключение. start(): начать измерения. stop(): прервать процесс. on(event, handler): подписка на события. getStatus(): текущий статус и метрики. disconnect(): безопасное закрытие.

ТЕСТЫ
Юнит: парсинг GATT ответов, нормализация данных, обработка incomplete. Интеграция: эмулятор BLE устройства или реальный стенд. Нагрузочные: длительное соединение и проверка стабильности.

РИСКИ
Закрытый протокол: работа только через официальные SDK или спецификации. Несовместимость GATT: graceful degradation. Зависимости платформ: BLE доступ требует Windows BLE API или node-ble.

КРИТЕРИИ ГОТОВНОСТИ
Спецификация GATT профиля зафиксирована, схема зон и точек измерений определена, обработка событий и таймаутов описана, тесты определены, интерфейс DeviceThickness документирован.
