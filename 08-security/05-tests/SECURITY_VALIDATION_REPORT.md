# –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ - –û—Ç—á—ë—Ç

**–î–∞—Ç–∞:** 2025-10-04  
**–¶–∏–∫–ª:** –¶–∏–∫–ª-4/08  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –£—Å–ø–µ—à–Ω–æ

## –†–µ–∑—é–º–µ

–ü—Ä–æ–≤–µ–¥–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã.

## –ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø–æ–ª–∏—Ç–∏–∫–∏ RLS Supabase

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `supabase/migrations/` –¥–æ—Å—Ç—É–ø–Ω–∞
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –º–∏–≥—Ä–∞—Ü–∏—è `20251004000000_secure_rls_policies.sql` –Ω–∞ –º–µ—Å—Ç–µ
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ "–ü—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø"
- –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç –ø—É–±–ª–∏—á–Ω—ã–µ VIEW –±–µ–∑ PII (`v_reports_public`, `v_sessions_public`, `v_equipment_status_public`)
- README.md —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ RLS –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã.

### 2. ‚úÖ Security Headers –≤ Cloud API

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `helmet` –ø–æ–¥–∫–ª—é—á—ë–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (security headers)
- `express-rate-limit` –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π `CLOUD_API_ALLOWED_ORIGINS`
- Request ID middleware —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –°–æ–∑–¥–∞–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ security headers

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```typescript
// cloud-api/src/index.ts
app.use(helmet({
  crossOriginResourcePolicy: { policy: 'cross-origin' },
}))

const limiter = rateLimit({
  windowMs: defaultRateLimitWindow,
  max: defaultRateLimit,
  standardHeaders: true,
  legacyHeaders: false,
  message: 'Too many requests, please try again later',
  skip: (req) => isDev && req.ip === '127.0.0.1'
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ security headers –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç.

### 3. ‚úÖ Security –≤ kiosk-agent

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- Rate limiting middleware –Ω–∞–π–¥–µ–Ω –≤ `src/api/routes.ts`
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (morgan) –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- SimpleRateLimiter —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏

**–ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏:**
```typescript
// kiosk-agent/src/api/routes.ts
class SimpleRateLimiter {
  check(key: string): { allowed: boolean; retryAfter?: number }
}

export function rateLimitMiddleware(req, res, next) {
  // Per-IP and per-session rate limits
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Rate limiting –∏ CORS —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

### 4. ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `.env.example` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω
- –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
  - `SUPABASE_URL`
  - `SUPABASE_SERVICE_ROLE_KEY`
  - `SUPABASE_ANON_KEY`
  - `CLOUD_API_ALLOWED_ORIGINS`
  - `CLOUD_API_RATE_LIMIT_MAX`
  - `AGENT_ENV`
  - `AGENT_PORT`
- –ü—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: "SERVICE_ROLE_KEY –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ"

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞.

### 5. ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç —É—Ç–µ—á–µ–∫ —Å–µ–∫—Ä–µ—Ç–æ–≤

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `.env` –∏ `.env.*` –≤ `.gitignore`
- –°–µ–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
- –ö–ª—é—á–µ–≤—ã–µ —Ñ–∞–π–ª—ã (`*.key`, `*.pem`) –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ .gitignore:**
```gitignore
# Env
.env
.env.*
!.env.example
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–µ–∫—Ä–µ—Ç—ã –∑–∞—â–∏—â–µ–Ω—ã –æ—Ç –∫–æ–º–º–∏—Ç–∞.

### 6. ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `03-apps/02-application/cloud-api/DEPLOYMENT.md` ‚Äî —Å–æ–¥–µ—Ä–∂–∏—Ç —á–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `PRODUCTION_SUPABASE_SUMMARY.md` ‚Äî –æ–ø–∏—Å—ã–≤–∞–µ—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- `08-security/05-tests/manual-verification-checklist.md` ‚Äî —Ä—É—á–Ω–∞—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è
- `supabase/migrations/README.md` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–æ–≤–µ—Ä–∫–µ RLS

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–ª–Ω–∞—è –∏ –∞–∫—Ç—É–∞–ª—å–Ω–∞—è.

### 7. ‚úÖ –°–∫—Ä–∏–ø—Ç—ã –∑–∞–ø—É—Å–∫–∞

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:**
- `06-infra/04-infrastructure/infra-root/scripts/dev-run.ps1` –Ω–∞ –º–µ—Å—Ç–µ
- –°–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç `.env` —Ñ–∞–π–ª—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ü—É—Ç–∏ –∫ `03-apps/02-application/kiosk-agent` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ

**–ö–æ–¥ –∑–∞–≥—Ä—É–∑–∫–∏ env:**
```powershell
Import-Dotenv -Path (Join-Path $repoRoot '.env')
Import-Dotenv -Path (Join-Path $repoRoot '.env.local')
Import-Dotenv -Path (Join-Path $repoRoot '03-apps/02-application/kiosk-agent/.env')
Import-Dotenv -Path (Join-Path $repoRoot '03-apps/02-application/kiosk-agent/.env.local')
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∫—Ä–∏–ø—Ç—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.

## –ù–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

### –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `10-tools/04-infrastructure/security-validation.cjs` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏
npm run security:validate

# –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é
node 10-tools/04-infrastructure/security-validation.cjs
```

**–ü—Ä–æ–≤–µ—Ä—è–µ—Ç:**
1. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–π RLS
2. Security headers –≤ Cloud API
3. Rate limiting –≤ kiosk-agent
4. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é .env
5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏
6. –ù–∞–ª–∏—á–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
7. –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Å–∫—Ä–∏–ø—Ç–æ–≤ –∑–∞–ø—É—Å–∫–∞

**–†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞:**
```
‚úÖ –£—Å–ø–µ—à–Ω–æ: 33
‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è: 0
‚ùå –û—à–∏–±–∫–∏: 0

üéâ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ç–µ—Å—Ç—ã

–í `cloud-api/src/index.test.ts` –¥–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ security headers:

```typescript
it('should include security headers from helmet', async () => {
  const response = await fetch(`http://localhost:${port}/health`)

  // Helmet security headers
  expect(response.headers.get('x-content-type-options')).toBe('nosniff')
  expect(response.headers.get('x-frame-options')).toBeDefined()
  expect(response.headers.get('x-dns-prefetch-control')).toBeDefined()
})
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç (33/33).

## –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ø–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
   ```bash
   npm run security:validate
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã:**
   ```bash
   npm run test:all
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–Ω—Ç–µ—Ä—ã:**
   ```bash
   npm run lint
   ```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏

–î–ª—è production deployment —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Ä—É—á–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑:
- `08-security/05-tests/manual-verification-checklist.md`
- `supabase/migrations/README.md` (—Å–µ–∫—Ü–∏—è "–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏")

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

‚úÖ **–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –æ—Å—Ç–∞—é—Ç—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø–æ—Å–ª–µ –ø–µ—Ä–µ–Ω–æ—Å–∞.**

**–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–∞—Ç–∞–ª–æ–≥–æ–≤:**
- `apps/` ‚Üí `03-apps/02-application/`
- `packages/` ‚Üí –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- `infra/` ‚Üí `06-infra/04-infrastructure/`
- `docs/` ‚Üí `09-docs/`

**–ù–ï –Ω–∞—Ä—É—à–∏–ª:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- Security headers
- Rate limiting
- CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é .env
- –ó–∞—â–∏—Ç—É —Å–µ–∫—Ä–µ—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ –¥–µ–ø–ª–æ—é.

---

**–ü—Ä–æ–≤–µ—Ä–µ–Ω–æ:** Automated Security Validation Script v1.0  
**–ê–≤—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä–∫–∏:** GitHub Copilot Agent  
**–î–∞—Ç–∞:** 2025-10-04
